# Fase 4: Camada de Rede, Concorrência e Servidor

Esta fase transforma a biblioteca em um serviço utilizável remotamente.

## Issue 4.1: Definir Protocolo e Implementar Parser de Comandos

Definir um protocolo de comunicação inambíguo (inspirado no RESP do Redis) e implementar o parser que o traduz em comandos estruturados.

- [ ] Documentar o protocolo de comprimento prefixado em `PROTOCOL.md`.
- [ ] Implementar o parser que transforma o stream da rede em objetos de comando.
- [ ] Garantir que o parser lide com comandos parciais ou múltiplos no mesmo stream.

## Issue 4.2: Criar Testes Unitários para o Parser de Protocolo

Validar formalmente o comportamento do parser de protocolo de forma isolada e sem depender de uma conexão de rede real.

- [ ] Testar a decodificação de comandos válidos (`SET`, `GET`, `DEL`).
- [ ] Testar o tratamento de múltiplos comandos em um único stream.
- [ ] Testar o tratamento de comandos incompletos (parciais).
- [ ] Testar o tratamento de comandos malformados (erros de sintaxe).
- [ ] Testar o suporte a dados binários e casos de borda.

## Issue 4.3: Implementar Servidor TCP Concorrente e Durável

Criar o servidor que aceita conexões TCP, gerencia múltiplos clientes de forma segura e executa seus comandos no `StorageEngine`.

- [ ] Implementar o servidor TCP que escuta em uma porta e usa o parser.
- [ ] Adotar um modelo de concorrência (ex: um thread por conexão).
- [ ] Proteger o acesso ao `StorageEngine` com um `threading.Lock` global para garantir thread-safety.
- [ ] Integrar chamadas `os.fsync()` no `StorageEngine` para garantir a durabilidade.
- [ ] Lidar graciosamente com a desconexão de clientes.

## Issue 4.4: Criar Testes de Integração End-to-End (E2E)

Testar o sistema completo, do cliente ao disco, para garantir que todos os componentes funcionam corretamente em conjunto.

- [ ] Testar o ciclo de vida básico (`SET`, `GET`, `DEL`) através da rede.
- [ ] Testar a persistência dos dados após a reinicialização do servidor.
- [ ] Testar a concorrência com múltiplos clientes realizando operações simultaneamente.
- [ ] Testar o tratamento de erros do protocolo (comandos malformados).
