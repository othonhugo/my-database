# Fase 1: Motor de Armazenamento (Log Append-Only)

Esta fase foca na correção e durabilidade dos dados, aceitando baixa performance de leitura inicialmente.

## Issue 1.1: Definir Interfaces Abstratas e Estrutura Base

Estabelecer o contrato base para o nosso motor de armazenamento e as exceções padrão do projeto. Isso garante a modularidade e um tratamento de erros limpo.

- [ ] Criar a estrutura de diretórios (`storage/`, `tests/`, `core/`).
- [ ] Criar `storage/engine.py` com a classe abstrata `StorageEngine` (usando `abc`).
- [ ] Definir métodos abstratos: `set(key, value)`, `get(key)`, `delete(key)`.
- [ ] Criar `core/exceptions.py` e definir a exceção base `MyDBError`.

## Issue 1.2: Implementar Escrita em Log com Formato Binário

Implementar a primeira versão do `StorageEngine`, chamada `AppendOnlyLogStorage`. O foco é na operação de escrita (`set`), garantindo que os dados sejam serializados de forma eficiente e anexados a um arquivo.

- [ ] Criar `storage/logger.py` com a classe `AppendOnlyLogStorage`.
- [ ] Definir um formato de registro binário usando `struct` (incluindo endianness).
- [ ] Implementar `__init__` que inicializa o arquivo de log.
- [ ] Implementar `set(key, value)` que serializa os dados e faz `append` no arquivo.
- [ ] Garantir que chaves e valores binários arbitrários sejam suportados.

## Issue 1.3: Implementar Leitura via Scan Completo e Exclusão Lógica

Completar a implementação do `AppendOnlyLogStorage` com as operações `get` e `delete`. A leitura exigirá varrer o arquivo, e a exclusão usará marcadores "tombstone".

- [ ] Definir um `Enum` para tipos de operação (`SET`, `DELETE`) e incluí-lo no header do registro.
- [ ] Atualizar `set()` para usar o tipo `SET`.
- [ ] Implementar `delete(key)` que escreve um registro com tipo `DELETE`.
- [ ] Implementar `get(key)` que varre o arquivo do início ao fim, aplicando a lógica "last-write-wins".
- [ ] Garantir que `get()` levante `LogKeyNotFoundError` para chaves não encontradas ou deletadas.

## Issue 1.4: Criar Suíte de Testes para o Motor de Armazenamento

Validar formalmente o comportamento do `AppendOnlyLogStorage`. Precisamos garantir que ele funciona no "happy path", em casos de borda, e que os dados persistem entre reinicializações.

- [ ] Configurar o ambiente de testes usando `pytest`.
- [ ] Testar o ciclo de vida básico de um registro (definições, atualizações, remoções...).
- [ ] Testar a durabilidade dos dados (escrever, fechar, reabrir, ler).
- [ ] Testar casos de borda (chaves/valores vazios, dados binários complexos).
- [ ] Testar a leitura de uma chave inexistente ou previamente deletada.
